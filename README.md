# Тестовое задания на стажировку

Проект реализован исключительно с использованием стандартной библиотеки Go, без сторонних зависимостей.

## Запуск приложения

Находясь в директории с проектом в терминале прописать:

### Без docker:

```
go run cmd/app/main.go
```

### Через docker:

```
docker build -t image_name:image_tag .
docker run -p 8080:8080 image_name:image_tag
```

(для теста image_name и image_tag можно указать любые)

Сервер будет доступен по адресу http://localhost:8080

#### Graceful shutdown

Приложение корректно завершает работу при получении сигналов:

- SIGINT
- SIGTERM
  То есть в терминале для завершения работы нажмите ctrl+c

## API эндпоинты

### POST /todos — создать новую задачу

Например:

```
curl -X POST http://localhost:8080/todos -H "Content-Type: application/json" -d '{"title": "Заголовок", "description": "Описание"}'
```

- заголовок не должен быть пустым, иначе код 400 и тело `note must have a title`

Получим:

```
{"id":1,"title":"Заголовок","description":"Описание","done":false}
```

### GET /todos — получить список всех задач

Например:

```
curl http://localhost:8080/todos
```

Получим:

- если задачи были добавлены - список всех задач:

```
[{"id":1,"title":"Заголовок","description":"Описание","done":false},{"id":2,"title":"Заголовок123","description":"Описание123","done":false}]
```

- если задач нет:

```
[]
```

### GET /todos/{id} — получить задачу по идентификатору

Например:

```
curl http://localhost:8080/todos/1
```

Получим:

- если задача была добавлена - получим эту задачу:

```
{"id":1,"title":"Заголовок","description":"Описание","done":false}
```

- Если задача с указанным идентификатором не найдена — 404 Not Found.

```
note by ID not found
```

### PUT /todos/{id} — обновить задачу по идентификатору - полная замена ресурса

Например:

```
curl -X PUT http://localhost:8080/todos/1 -H "Content-Type: application/json" -d '{"title": "Обновленная задача", "done": true}'
```

- заголовок не должен быть пустым, иначе код 400 и тело `note must have a title`
  Получим:

- Если задача найдена

```
{"id":1,"title":"Обновленная задача","description":"","done":true}
```

- Если задача с указанным идентификатором не найдена — 404 Not Found.

```
note by ID not found
```

### DELETE /todos/{id} — удалить задачу по идентификатору

Например:

```
curl -X DELETE http://localhost:8080/todos/1
```

- Если такой id был, задача удалится и получим код 204.

- Если задача с указанным идентификатором не найдена — 404 Not Found.

```
note by ID not found
```

#### Обработка ошибок

Задача не найдена - 404
Ошибка валидации - 400
Неверный JSON - 400
Таймаут/отмена context - 504
Внутренняя ошибка сервера - 500

## Хранилище данных:

Хранения данных в проекте реализовано с использованием паттерна _Dependency Injection_ - inmemory хранилище можно легло заменить на другое, заимплементировав интерфейс хранилища и передав объект хранилища в сервис хэндлера.

## Middleware:

- LoggingMiddleware: логирование всех входящих запросов с временем их выполнения
- TimeoutMiddleware: таймаут 5 секунд для каждого запроса с помощью context, который прокидывается до конца - до хранилища данных

## Unit-тесты

Unit-тесты реализованы для:

- слоя repository (inmemory БД)
- слоя handler (HTTP-хендлеры с mock-репозиторием)

Покрываемые кейсы:

- успешное создание / обновление / удаление / получение
- ошибка валидации
- несуществующий идентификатор
- отмена context
- ошибки на уровне repository при запросе
- некорректный JSON
- неверный Content-Type
  `Покрывать кейс с дублированием идентификатора не требуется, так как хранилеще реализовано с использованием atomic, что гарантирует уникальность идентификаторов.`
